
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../overview/">
      
      
        <link rel="next" href="../cognitive_reserve/">
      
      
      <link rel="icon" href="../../../docs/logos/enigma_300DPI_small.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>FreeSurfer 7 - ENIGMA-PD docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#welcome-to-the-enigma-pd-freesurfer-7-guidelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ENIGMA-PD docs" class="md-header__button md-logo" aria-label="ENIGMA-PD docs" data-md-component="logo">
      
  <img src="../../../docs/logos/enigma_300DPI_small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ENIGMA-PD docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FreeSurfer 7
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ENIGMA-PD docs" class="md-nav__button md-logo" aria-label="ENIGMA-PD docs" data-md-component="logo">
      
  <img src="../../../docs/logos/enigma_300DPI_small.png" alt="logo">

    </a>
    ENIGMA-PD docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About ENIGMA-PD
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            About ENIGMA-PD
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../working_group/core_team/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core team
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../working_group/sites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../working_group/new_sites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Information for new sites
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ongoing Projects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Ongoing Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    FreeSurfer 7
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    FreeSurfer 7
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#leaderboard" class="md-nav__link">
    <span class="md-ellipsis">
      Leaderboard
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-nipoppy" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up Nipoppy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting up Nipoppy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-from-source-data-either-dicoms-or-niftis-that-are-not-yet-in-bids" class="md-nav__link">
    <span class="md-ellipsis">
      Starting from source data (either DICOMs or NIfTIs that are not yet in BIDS)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-with-bidsified-data" class="md-nav__link">
    <span class="md-ellipsis">
      Starting with BIDSified data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Starting with BIDSified data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bids-datasets-without-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      BIDS datasets without sessions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-from-data-already-processed-with-freesurfer7" class="md-nav__link">
    <span class="md-ellipsis">
      Starting from data already processed with FreeSurfer7
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-freesurfer-7" class="md-nav__link">
    <span class="md-ellipsis">
      Running FreeSurfer 7
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running FreeSurfer 7">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Run pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#track-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Track pipeline output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Extract pipeline output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-freesurfer-subsegmentations" class="md-nav__link">
    <span class="md-ellipsis">
      Running the FreeSurfer subsegmentations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running the FreeSurfer subsegmentations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling-the-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling the Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-nipoppy-pipeline-specification-files-for-this-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Getting the Nipoppy pipeline specification files for this pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-your-global-config-file" class="md-nav__link">
    <span class="md-ellipsis">
      Change your global config file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Change your global config file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-check" class="md-nav__link">
    <span class="md-ellipsis">
      Final check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Running the pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracking-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Tracking pipeline output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extracting-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Extracting pipeline output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-assessment-part-1-running-the-fs-qc-toolbox" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Assessment part 1: Running the FS-QC toolbox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quality Assessment part 1: Running the FS-QC toolbox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling-the-docker-image_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling the Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-nipoppy-pipeline-specification-files-for-this-pipeline_1" class="md-nav__link">
    <span class="md-ellipsis">
      Getting the Nipoppy pipeline specification files for this pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-your-global-config-file_1" class="md-nav__link">
    <span class="md-ellipsis">
      Change your global config file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Change your global config file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-check_1" class="md-nav__link">
    <span class="md-ellipsis">
      Final check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-pipeline_1" class="md-nav__link">
    <span class="md-ellipsis">
      Running the pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-fs-qc-output" class="md-nav__link">
    <span class="md-ellipsis">
      Expected FS-QC output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Expected FS-QC output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-notes-for-viewing-and-copying-files" class="md-nav__link">
    <span class="md-ellipsis">
      Important notes for viewing and copying files:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Important notes for viewing and copying files:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#locally" class="md-nav__link">
    <span class="md-ellipsis">
      Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      On the server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-check_2" class="md-nav__link">
    <span class="md-ellipsis">
      Final check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-assessment-part-2-performing-a-visual-quality-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Assessment part 2: Performing a visual quality assessment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-sharing" class="md-nav__link">
    <span class="md-ellipsis">
      Data sharing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cognitive_reserve/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cognitive reserve
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    White matter lesions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mspm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multiple Symptom Progression Modelling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuropsych/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Neuropsychiatry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spinal_cord/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spinal Cord
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../imaging_genetics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Imaging Genetics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normative_modelling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Normative modelling (fMRI)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Completed Projects
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Completed Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../completed/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../completed/cort_sub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cortical-Subcortical
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../completed/shape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subcortical shape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../completed/tbss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Diffusion (TBSS)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../completed/py-sustain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PySustain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../completed/connectomics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connectomics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resources/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resources/preregistrations.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ENIGMA-PD preregistrations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#leaderboard" class="md-nav__link">
    <span class="md-ellipsis">
      Leaderboard
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-nipoppy" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up Nipoppy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting up Nipoppy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-from-source-data-either-dicoms-or-niftis-that-are-not-yet-in-bids" class="md-nav__link">
    <span class="md-ellipsis">
      Starting from source data (either DICOMs or NIfTIs that are not yet in BIDS)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-with-bidsified-data" class="md-nav__link">
    <span class="md-ellipsis">
      Starting with BIDSified data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Starting with BIDSified data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bids-datasets-without-sessions" class="md-nav__link">
    <span class="md-ellipsis">
      BIDS datasets without sessions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-from-data-already-processed-with-freesurfer7" class="md-nav__link">
    <span class="md-ellipsis">
      Starting from data already processed with FreeSurfer7
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-freesurfer-7" class="md-nav__link">
    <span class="md-ellipsis">
      Running FreeSurfer 7
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running FreeSurfer 7">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Run pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#track-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Track pipeline output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Extract pipeline output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-freesurfer-subsegmentations" class="md-nav__link">
    <span class="md-ellipsis">
      Running the FreeSurfer subsegmentations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running the FreeSurfer subsegmentations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling-the-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling the Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-nipoppy-pipeline-specification-files-for-this-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Getting the Nipoppy pipeline specification files for this pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-your-global-config-file" class="md-nav__link">
    <span class="md-ellipsis">
      Change your global config file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Change your global config file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-check" class="md-nav__link">
    <span class="md-ellipsis">
      Final check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Running the pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracking-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Tracking pipeline output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extracting-pipeline-output" class="md-nav__link">
    <span class="md-ellipsis">
      Extracting pipeline output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-assessment-part-1-running-the-fs-qc-toolbox" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Assessment part 1: Running the FS-QC toolbox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quality Assessment part 1: Running the FS-QC toolbox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling-the-docker-image_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling the Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-nipoppy-pipeline-specification-files-for-this-pipeline_1" class="md-nav__link">
    <span class="md-ellipsis">
      Getting the Nipoppy pipeline specification files for this pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-your-global-config-file_1" class="md-nav__link">
    <span class="md-ellipsis">
      Change your global config file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Change your global config file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-check_1" class="md-nav__link">
    <span class="md-ellipsis">
      Final check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-pipeline_1" class="md-nav__link">
    <span class="md-ellipsis">
      Running the pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expected-fs-qc-output" class="md-nav__link">
    <span class="md-ellipsis">
      Expected FS-QC output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Expected FS-QC output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-notes-for-viewing-and-copying-files" class="md-nav__link">
    <span class="md-ellipsis">
      Important notes for viewing and copying files:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Important notes for viewing and copying files:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#locally" class="md-nav__link">
    <span class="md-ellipsis">
      Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      On the server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-check_2" class="md-nav__link">
    <span class="md-ellipsis">
      Final check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-assessment-part-2-performing-a-visual-quality-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Assessment part 2: Performing a visual quality assessment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-sharing" class="md-nav__link">
    <span class="md-ellipsis">
      Data sharing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="welcome-to-the-enigma-pd-freesurfer-7-guidelines">Welcome to the ENIGMA-PD FreeSurfer 7 guidelines!</h1>
<p>This page is created to guide collaborating ENIGMA-PD sites through the FreeSurfer processing steps. The outcomes include cortical thickness, cortical surface area, and volume of subcortical regions and their subfields. All steps and code required are combined into the guidelines presented here. If you have any questions, concerns, or issues, please contact the ENIGMA-PD core team at enigma-pd@amsterdamumc.nl. </p>
<h2 id="leaderboard">Leaderboard</h2>
<p>To help motivate and monitor each site's progress, we maintain a leaderboard that outlines all the steps detailed in these guidelines. If you are in charge of data processing at your site, please request access and regularly update your progress on the current steps on the <a href="https://docs.google.com/spreadsheets/d/13iGfh-97ZYnAyjT5egBDHmGhqXbsl1yo1A6QnPXQYbY/edit?usp=sharing">ENIGMA-PD Leaderboard</a>.</p>
<h2 id="overview">Overview</h2>
<p>The figure shows the expected outcomes and corresponding processing steps - most of which can be performed using the Nipoppy framework and helper Python package. We strongly recommend adoption of Nipoppy tools to simplify coordination and ensure reproducibility of this end-to-end process across all sites. 
<img alt="enigma-nipoppy-FS7-upgrade-overview" src="https://github.com/user-attachments/assets/aae8449c-58cf-4889-92de-979f79082e28" /></p>
<h2 id="setting-up-nipoppy">Setting up Nipoppy</h2>
<p>Nipoppy is a lightweight framework for standardized data organization and processing of neuroimaging-clinical datasets. Its goal is to help users adopt the <a href="https://www.go-fair.org/fair-principles/">FAIR principles</a> and improve the reproducibility of studies. </p>
<p>The ongoing collaboration between the ENIGMA-PD team and Nipoppy team has streamlined data curation, processing, and analysis workflows, which significantly simplifies tracking of data availability, addition of new pipelines and upgrading of existing pipelines. The ENIGMA-PD and Nipoppy team is available to support and guide users through the process of implementing the framework, ensuring a smooth transition. To join the Nipoppy support community, we recommend joining their <a href="https://discord.gg/dQGYADCCMB">Discord channel</a>. Here you can ask questions and find answers while working with Nipoppy. </p>
<p><strong>Here, primairly we will use Nipoppy to help you with 1) BIDSification, 2) FreeSurfer7 processing, 3) Sub-segmentation and 4) Quality control.</strong> </p>
<p>For more information, see the <a href="https://nipoppy.readthedocs.io/en/stable/index.html">Nipoppy documentation</a>.</p>
<h3 id="getting-started">Getting started</h3>
<p>To install Nipoppy, we refer to the <a href="https://nipoppy.readthedocs.io/en/stable/overview/installation.html">Installation page</a>. </p>
<p>Once Nipoppy is successfully installed, you will need to create a Nipoppy dataset and populate it with your data. There are a few different starting points depending on the current state of your dataset. If you have your data already in BIDS format, click <a href="#starting-with-bidsified-data">here</a>. If you have DICOM of NIFTI files that are not yet in BIDS, continue below. If you're not sure what BIDS is or if you're wondering why you should convert your data into BIDS at all, you can find more info <a href="../resources/BIDS_info.md">here</a>.</p>
<h4 id="starting-from-source-data-either-dicoms-or-niftis-that-are-not-yet-in-bids">Starting from source data (either DICOMs or NIfTIs that are <em>not yet</em> in BIDS)</h4>
<p>This is the scenario assumed by the Nipoppy <a href="https://nipoppy.readthedocs.io/en/stable/overview/quickstart.html">Quickstart page</a>. Follow this guide to:
1. Create an empty Nipoppy dataset (i.e. directory tree)
2. Write a manifest file representing your data
3. Modify the global config file with paths to e.g., path to your container directory</p>
<p>Note: if your dataset is cross-sectional (i.e. only has one session), you still need to create a <code>session_id</code> for the manifest. In this case the value would be the same for all participants.</p>
<p>When you reach the end of the Quickstart, it is time to <a href="https://nipoppy.readthedocs.io/en/stable/how_to_guides/user_guide/organizing_imaging.html">copy and reorganize</a> your raw imaging data to prepare them for BIDS conversion. Once this is done, you can find how to perform the BIDSification within the Nipoppy framework <a href="https://nipoppy.readthedocs.io/en/stable/how_to_guides/user_guide/bids_conversion.html">here</a>. We recommend applying a containerized BIDS-conversion pipeline that can be run within Nipoppy. <a href="../resources/Container_platforms.md">Here</a> you can find how to download containers and <a href="../resources/getting_ENIGMA-PD_pipeline_config_files.md">here</a> you can find how to run them within Nipoppy.</p>
<h4 id="starting-with-bidsified-data">Starting with BIDSified data</h4>
<p>If your dataset is already in BIDS, then the manifest-generation step can be skipped by initializing the Nipoppy dataset with this command, specifying the path to your new dataset and the path to your existing BIDS data:</p>
<pre><code class="language-bash">nipoppy init --dataset &lt;dataset_root&gt; --bids-source &lt;path_to_existing_bids_data&gt;
</code></pre>
<p>This command will create a Nipoppy dataset (i.e. directory tree) from preexisting BIDS dataset and automatically generate a manifest file for you! </p>
<h5 id="bids-datasets-without-sessions">BIDS datasets without sessions</h5>
<p>If the existing BIDS data does not have session-level folders, Nipoppy will create "dummy sessions" (called <code>unnamed</code>) in the manifest. This is because the Nipoppy manifest still requires a non-empty <code>session_id</code> value when imaging data is available for a participant.</p>
<p>If it is feasible to redo the BIDSification to include session folders, we recommend doing so since this is considered good practice. Otherwise, Nipoppy can still be run, but you will need to make some manual changes. For more information, see <a href="https://nipoppy.readthedocs.io/en/stable/how_to_guides/init/bids.html#bids-data-without-sessions">here</a></p>
<h4 id="starting-from-data-already-processed-with-freesurfer7">Starting from data already processed with FreeSurfer7</h4>
<p>We still encourage you to use Nipoppy to organize your source and/or BIDS data with your processed FS7 output to make use of automated trackers and downstream subsegmentation processing. However, you may need to some help depending on your version of FreeSurfer and naming convention of <code>participant_id</code>. Reach out to us on our <a href="https://discord.gg/dQGYADCCMB">Discord channel</a> and we would be happy to help! </p>
<h2 id="running-freesurfer-7">Running FreeSurfer 7</h2>
<p>When you reach this point, the hardest part is behind you and we can finally come to the real stuff. We will run FreeSurfer 7 through fMRIPrep using Nipoppy. See <a href="https://nipoppy.readthedocs.io/en/latest/how_to_guides/user_guide/processing.html">here</a> for additional information about running processing pipelines with Nipoppy.</p>
<p>We will apply the FreeSurfer functionalities that are included in the fMRIPrep pipeline. We assume here that you have Apptainer installed as your container platform (see <a href="../resources/Container_platforms.md">here</a> for more info and how to get it). Now, you can pull the fMRIPrep container in the following way:</p>
<pre><code class="language-bash">apptainer build fmriprep_24.1.1.sif \
                    docker://nipreps/fmriprep:24.1.1
</code></pre>
<p>Make sure that you have the fMRIPrep container stored in the containers folder that you reference to in your global config file.</p>
<p>For more information on fMRIPrep, see the <a href="https://fmriprep.org/en/stable/">fMRIPrep documentation</a></p>
<h3 id="setting-up-configuration">Setting up configuration</h3>
<p>Next, we will need to install the fMRIPrep pipeline within Nipoppy. You can do this by simply running:</p>
<pre><code class="language-bash">nipoppy pipeline install --dataset &lt;dataset_root&gt; 15427833
</code></pre>
<p>15427833 is the Zenodo ID for the Nipoppy configuration files for fmriprep 24.1.1. Read more about this step <a href="../resources/getting_ENIGMA-PD_pipeline_config_files.md">here</a>.</p>
<p>Once the pipeline is installed, open the global config file and check whether the correct fMRIPrep version is included under <code>PIPELINE_VARIABLES</code>.
The following paths should be replaced here under the correct version of the fMRIPrep pipeline in the global config file:
- <code>&lt;FREESURFER_LICENSE_FILE&gt;</code> (required to run FreeSurfer; you can get a FreeSurfer licence for free at <a href="https://surfer.nmr.mgh.harvard.edu/registration.html">the FreeSurfer website</a>)
- <code>&lt;TEMPLATEFLOW_HOME&gt;</code> (see <a href="../resources/Templateflow_info.md">here</a> for more info on Templateflow)</p>
<h3 id="run-pipeline">Run pipeline</h3>
<p>Finally, simply run the following line of code:</p>
<pre><code class="language-bash">nipoppy process --pipeline fmriprep --pipeline-version 24.1.1 --dataset &lt;dataset_root&gt;
</code></pre>
<p>This should initiate the FS7 segmentation of your T1-weighted images! </p>
<p><strong>Note:</strong> the command above will run all the participants and sessions in a loop, which may be inefficient. If you're using an HPC, you may want to submit a batch job to process all participants/sessions. Nipoppy can help you do this by
1. Generate a list of "remaining" participants to be processed for your job-subission script: <code>nipoppy process --pipeline fmriprep --pipeline-version 24.1.1 --dataset &lt;dataset_root&gt; --write-list &lt;path_to_participant_list&gt;</code>
2. Automatically submit HPC jobs for you with additional configuration (more info <a href="https://nipoppy.readthedocs.io/en/latest/how_to_guides/parallelization/hpc_scheduler.html">here</a>)</p>
<h3 id="track-pipeline-output">Track pipeline output</h3>
<p>The <code>nipoppy track-processing</code> command can help keep track of which participants/sessions have all the expected output files for a given processing pipeline. See <a href="https://nipoppy.readthedocs.io/en/latest/how_to_guides/user_guide/tracking.html">here</a> for more information. Running this command will update the <code>processing_status.tsv</code> under the <code>derivatives</code> folder.</p>
<h3 id="extract-pipeline-output">Extract pipeline output</h3>
<p>For automatic extraction of the cortical thickness, cortical surface area and subcortical volume into .tsv files, you can use another <a href="../resources/getting_ENIGMA-PD_pipeline_config_files.md">Nipoppy pipeline</a>, called fs_stats. The Zenodo ID for this pipeline is 15427856, so you can install it with the following command:</p>
<pre><code class="language-bash">nipoppy pipeline install --dataset &lt;dataset_root&gt; 15427856
</code></pre>
<p>Remember to define the freesurfer licens file path in your global config file under the newly installed pipeline. Then, you can simply run </p>
<pre><code class="language-bash">nipoppy extract --pipeline fs_stats --dataset &lt;dataset_root&gt;
</code></pre>
<p>to get things going. You can find the extracted data under <code>&lt;dataset_root&gt;/derivatives/freesurfer/7.3.2/idp/</code>.</p>
<p>Once FS7 processing and extraction has completed, you can move on to the subsegmentations.</p>
<hr />
<h2 id="running-the-freesurfer-subsegmentations">Running the FreeSurfer subsegmentations</h2>
<p>🎉 <strong>It’s go time!</strong><br />
The <strong>subsegmentations pipeline</strong> is now ready to be run! Since you’ve all just been through fMRIPrep in Nipoppy, this next step will feel familiar as running this pipeline follows a very similar workflow.</p>
<p><strong>About the pipeline:</strong>
This pipeline uses existing FreeSurfer 7 functionalities to extract subnuclei volumes from subcortical regions like the <em>thalamus</em>, <em>hippocampus</em>, <em>brainstem</em>, <em>hypothalamus</em>, <em>amygdala</em>, and <em>hippocampus</em>. It requires completed FreeSurfer output (<code>recon-all</code>) and integrates the subsegmentation outputs directly into the existing <code>/mri</code> and <code>/stats</code> directories. Additionally, the pipeline will perform <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/Samseg">Sequence Adaptive Multimodal SEGmentation (SAMSEG)</a> on T1w images in order to calculate a superior intracranial volume.</p>
<h3 id="pulling-the-docker-image">Pulling the Docker image</h3>
<p>You need to download the container image that will run the subsegmentations. Use the following Apptainer command to pull the image from Docker Hub:</p>
<pre><code class="language-bash">apptainer build freesurfer_subseg_1.0.sif docker://nichyconsortium/freesurfer_subseg:1.0
</code></pre>
<p>Make sure the resulting image file is placed in the container directory referenced in your global config file.</p>
<h3 id="getting-the-nipoppy-pipeline-specification-files-for-this-pipeline">Getting the Nipoppy pipeline specification files for this pipeline</h3>
<p>To get the Nipoppy specification files for the subsegmentation container, run:</p>
<pre><code class="language-bash">nipoppy pipeline install --dataset &lt;dataset_root&gt; 15877956
</code></pre>
<p>Read more about this step <a href="../resources/getting_ENIGMA-PD_pipeline_config_files.md">here</a>.</p>
<p><strong>Note:</strong> If you have multiple T1w images per subject per session, the container will throw an error. In this case, you will need to open the invocation file under <code>&lt;dataset_root&gt;/pipelines/processing/freesurfer_subseg-1.0/</code> and specify the name of the desired T1w image for SAMSEG in the following way:</p>
<pre><code>&quot;t1_image_path&quot;: &quot;[[NIPOPPY_BIDS_PARTICIPANT_ID]]_[[NIPOPPY_BIDS_SESSION_ID]]_&lt;edit-me&gt;_T1w.nii.gz&quot;
</code></pre>
<h3 id="change-your-global-config-file">Change your global config file</h3>
<p>Open the global config file and add the path to your freesurfer license file under the freesurfer_subseg pipeline, just like you did for the fMRIPrep pipeline:</p>
<pre><code class="language-json">&quot;PIPELINE_VARIABLES&quot;: {
  &quot;BIDSIFICATION&quot;: {},
  &quot;PROCESSING&quot;: {
    &quot;fmriprep&quot;: {
      &quot;24.1.1&quot;: {
        &quot;FREESURFER_LICENSE_FILE&quot;: &quot;path/to/license/file/license.txt&quot;,
        &quot;TEMPLATEFLOW_HOME&quot;: &quot;path/to/templateflow/&quot;
      }
    },
    &quot;freesurfer_subseg&quot;: {
      &quot;1.0&quot;: {
        &quot;FREESURFER_LICENSE_FILE&quot;: &quot;path/to/license/file/license.txt&quot;
      }
    }
  }
}
</code></pre>
<h4 id="final-check">Final check</h4>
<p>Before trying to run the pipeline, confirm that the pipeline is recognized by running <code>nipoppy pipeline list</code>. This will print a list of the available pipelines.</p>
<h3 id="running-the-pipeline">Running the pipeline</h3>
<p>To run the subsegmentation pipeline, use the following command:</p>
<pre><code class="language-bash">nipoppy process --pipeline freesurfer_subseg --pipeline-version 1.0 --dataset &lt;dataset_root&gt;
</code></pre>
<h3 id="tracking-pipeline-output">Tracking pipeline output</h3>
<p>Use the <code>nipoppy track-processing</code> command to check which participants/sessions have complete output:</p>
<pre><code class="language-bash">nipoppy track-processing --pipeline freesurfer_subseg --dataset &lt;dataset_root&gt;
</code></pre>
<p>This helps you confirm whether the pipeline ran successfully across your dataset (again, check <code>processing_status.tsv</code> under the <code>derivatives</code> folder).</p>
<h3 id="extracting-pipeline-output">Extracting pipeline output</h3>
<p>The pipeline for extraction of data from the subsegmentation is under construction. Stay tuned for updates! You can already extract data from the standard FreeSurfer 7 segementation (see <a href="#extract-pipeline-output">here</a>) and continue with running the fsqc toolbox as described below.</p>
<hr />
<h2 id="quality-assessment-part-1-running-the-fs-qc-toolbox">Quality Assessment part 1: Running the FS-QC toolbox</h2>
<p>Congratulations, you made it to the quality assessment! For this purpose, we will use FreeSurfer Quality Control (FS-QC) toolbox. The <a href="https://github.com/Deep-MI/fsqc">FS-QC toolbox</a> takes existing FreeSurfer (or FastSurfer) output and computes a set of quality control metrics. These will be reported in a summary table and/or .html page with screenshots to allow for visual inspection of the segmentations.</p>
<h3 id="pulling-the-docker-image_1">Pulling the Docker image</h3>
<p>You need to download the container image that will run the freesurfer quality control pipeline. Use the following command to pull the image from Docker Hub:</p>
<pre><code class="language-bash">apptainer build fsqc_2.1.4.sif docker://deepmi/fsqcdocker:2.1.4
</code></pre>
<p>Make sure the resulting image file is placed in the container directory referenced in your global Nipoppy configuration.</p>
<h3 id="getting-the-nipoppy-pipeline-specification-files-for-this-pipeline_1">Getting the Nipoppy pipeline specification files for this pipeline</h3>
<p>To get the Nipoppy specification files for the FS-QC container, run:</p>
<pre><code class="language-bash">nipoppy pipeline install --dataset &lt;dataset_root&gt; 17100133
</code></pre>
<p>Read more about this step <a href="../resources/getting_ENIGMA-PD_pipeline_config_files.md">here</a>.</p>
<h3 id="change-your-global-config-file_1">Change your global config file</h3>
<p>Open the global config file and add the correct freesurfer version (7.3.2) under the fsqc pipeline.</p>
<h4 id="final-check_1">Final check</h4>
<p>Before trying to run the pipeline, confirm that the pipeline is recognized by running <code>nipoppy pipeline list</code>. This will print a list of the available pipelines.</p>
<h3 id="running-the-pipeline_1">Running the pipeline</h3>
<p>To run the subsegmentation pipeline, use the following command:</p>
<pre><code class="language-bash">nipoppy process --pipeline fsqc --pipeline-version 2.1.4 --pipeline-step process --dataset &lt;dataset_root&gt;
</code></pre>
<h3 id="expected-fs-qc-output">Expected FS-QC output</h3>
<p>After running the command, you will find all results inside the derivatives folder. The output will include:</p>
<ul>
<li>
<p><strong>Several folders</strong>, most of them corresponding to the flags used in the command, such as: <code>screenshots</code>, <code>surfaces</code>, <code>skullstrip</code>, <code>hypothalamus</code>, <code>hippocampus</code>, and also, <code>status</code>, <code>metrics</code></p>
</li>
<li>
<p><strong>A CSV file</strong> (<code>fsqc-results.csv</code>) summarizing quantitative quality control metrics for all subjects.</p>
</li>
<li>
<p><strong>A main HTML summary file</strong> (<code>fsqc-results.html</code>) that aggregates all subject screenshots for easy visual inspection.</p>
</li>
</ul>
<p>You can verify that images were created for all subjects by running</p>
<pre><code class="language-bash">nipoppy track-processing --pipeline fsqc --pipeline-step process-tracking --dataset &lt;dataset_root&gt;
</code></pre>
<p>and checking <code>processing_status.tsv</code> under the <code>derivatives</code> folder.</p>
<h4 id="important-notes-for-viewing-and-copying-files">Important notes for viewing and copying files:</h4>
<h5 id="locally">Locally</h5>
<ul>
<li>
<p>We <strong>strongly recommend downloading the entire output folder locally</strong> before opening the HTML file. Opening the HTML on a server or network drive is often slow and may cause images not to load properly.</p>
</li>
<li>
<p>When copying files, <strong>make sure to include all generated folders</strong> (such as <code>screenshots</code>, <code>surfaces</code>, etc.) along with the <code>fsqc-results.html</code> file. These folders contain the images referenced in the HTML and are essential for proper display.</p>
</li>
</ul>
<h5 id="on-the-server">On the server</h5>
<ul>
<li>If you have not experienced such issues before and prefer to work directly on your server, you can instead open the HTML file in your available browser (for example: <code>firefox fsqc-results.html</code>).</li>
</ul>
<h5 id="final-check_2">Final check</h5>
<ul>
<li>When opening the <code>fsqc-results.html</code> file:  </li>
<li>Scroll through the subjects to confirm all images load and no data is missing.  </li>
<li>Click on any image to zoom in, or right-click and choose “Open in new tab” and inspect details more closely.</li>
</ul>
<hr />
<h2 id="quality-assessment-part-2-performing-a-visual-quality-assessment">Quality Assessment part 2: Performing a visual quality assessment</h2>
<p>Quality checking is essential to make sure the output that you have produced is accurate and reliable. Even small errors or artifacts in images can lead to big mistakes in analysis and interpretation, so careful checks help us to verify whether we can savely include a certain region of interest or participant in our analysis. For the FreeSurfer output, we will follow standardized ENIGMA instructions on how to decide on the quality of the cortical and subcortical segmentations. <strong>At this stage, visual quality assessment of the subsegmentations (e.g., thalamic or hippocampal nuclei) is not required, as there are no established protocols yet and the process would be highly time-consuming; statistical checks (e.g., outlier detection) can be used instead. This may be followed up at a later stage, once there is a project that specifically focuses on these outcomes and the necessary anatomical expertise is available to develop a dedicated quality control manual.</strong></p>
<p>You can find the updated ENIGMA-PD QC instructions for visual inspection <a href="../resources/ENIGMA-PD_visual_QC_instructions.md">here</a>.</p>
<hr />
<h2 id="data-sharing">Data sharing</h2>
<p>After completing all of the above steps, you're ready to share your derived data with the ENIGMA-PD core team. Please:</p>
<ul>
<li>Review the .tsv and Excel spreadsheets for completeness, ensuring all participants are included, there are no missing or unexpected data points, and quality assessment scores have been assigned to each ROI and participant.</li>
<li>Confirm whether you are authorized to share the quality check .png files. These will be used, along with your quality assessment scores, to help train automated machine learning models for ENIGMA's quality checking pipelines, to eliminate the need for manual checking in the future.</li>
</ul>
<p>Once these checks are complete, email enigma-pd@amsterdamumc.nl to receive a personalized and secure link to a SURFdrive folder where you can temporarily upload the .csv files and, if applicable, the QA .png files. If your site has another preferred method for sharing data, please let us know, and we will try to accommodate it. We will then move the files to our central storage on the LONI server hosted by USC.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>